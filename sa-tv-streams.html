
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA TV Streams</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        input[type="file"], select, button {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="file"] {
            background: #4CAF50;
            color: white;
        }

        button {
            background: #ff6b35;
            color: white;
            font-weight: bold;
        }

        button:hover, input[type="file"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .channel-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .channel-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.2);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .channel-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .channel-info {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .play-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
        }

        .player-container {
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            display: none;
        }

        #videoPlayer {
            width: 100%;
            height: 500px;
            background: #000;
        }

        .player-controls {
            padding: 20px;
            background: rgba(0,0,0,0.8);
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status {
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
        }

        .favorites {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .channel-grid {
                grid-template-columns: 1fr;
            }
            
            #videoPlayer {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáøüá¶ SA TV Streams</h1>
            <p>Load your M3U playlist and enjoy South African channels</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Load M3U Playlist</label>
                <input type="file" id="m3uFile" accept=".m3u,.m3u8">
            </div>
            <button onclick="loadSampleChannels()">Load Sample Channels</button>
            <select id="categoryFilter">
                <option value="">All Categories</option>
            </select>
        </div>

        <div id="status" class="status" style="display: none;"></div>

        <div id="channelGrid" class="channel-grid"></div>

        <div class="player-container" id="playerContainer">
            <video id="videoPlayer" controls crossorigin="anonymous" playsinline></video>
            <div class="player-controls">
                <button onclick="toggleFullscreen()" id="fullscreenBtn">‚õ∂ Fullscreen</button>
                <button onclick="addToFavorites()" id="favoriteBtn">‚≠ê Favorite</button>
                <button onclick="hidePlayer()">‚ùå Close</button>
            </div>
        </div>

        <div class="favorites" id="favoritesSection" style="display: none;">
            <h3>‚≠ê Favorites</h3>
            <div id="favoritesList"></div>
        </div>
    </div>

    <script>
        let channels = [];
        let currentHls = null;
        let currentChannel = null;
        let favorites = JSON.parse(localStorage.getItem('saTvFavorites')) || [];

        const video = document.getElementById('videoPlayer');
        const channelGrid = document.getElementById('channelGrid');
        const playerContainer = document.getElementById('playerContainer');
        const status = document.getElementById('status');
        const categoryFilter = document.getElementById('categoryFilter');

        // Sample South African channels (free/public streams)
        const sampleChannels = [
            {
                name: "SABC 1",
                url: "https://playlist.example.com/sabc1.m3u8", // Replace with real streams
                category: "Public",
                logo: "üì∫"
            },
            {
                name: "SABC 2", 
                url: "https://playlist.example.com/sabc2.m3u8",
                category: "Public",
                logo: "üì∫"
            },
            {
                name: "SABC News",
                url: "https://playlist.example.com/sabcnews.m3u8", 
                category: "News",
                logo: "üì∞"
            },
            {
                name: "e.tv",
                url: "https://playlist.example.com/etv.m3u8",
                category: "Entertainment",
                logo: "üé≠"
            }
        ];

        document.getElementById('m3uFile').addEventListener('change', handleM3UFile);

        function handleM3UFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                parseM3U(e.target.result);
            };
            reader.readAsText(file);
        }

        function parseM3U(content) {
            channels = [];
            const lines = content.split('\n');
            let currentChannel = {};

            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    const nameMatch = line.match(/tvg-name="([^"]+)"/);
                    const groupMatch = line.match(/group-title="([^"]+)"/);
                    currentChannel = {
                        name: nameMatch ? nameMatch[1] : 'Unknown Channel',
                        category: groupMatch ? groupMatch[1] : 'General',
                        logo: 'üì∫'
                    };
                } else if (line.startsWith('http') && currentChannel.name) {
                    currentChannel.url = line;
                    channels.push({...currentChannel});
                    currentChannel = {};
                }
            });

            filterCategories();
            renderChannels();
            showStatus('‚úÖ Loaded ' + channels.length + ' channels from M3U file');
        }

        function loadSampleChannels() {
            channels = [...sampleChannels];
            renderChannels();
            showStatus('‚úÖ Loaded sample South African channels');
        }

        function renderChannels(filteredChannels = channels) {
            channelGrid.innerHTML = '';
            
            filteredChannels.forEach((channel, index) => {
                const card = document.createElement('div');
                card.className = 'channel-card';
                card.onclick = () => playChannel(channel);
                
                const isFavorite = favorites.some(fav => fav.url === channel.url);
                
                card.innerHTML = `
                    <div class="channel-name">${channel.logo || 'üì∫'} ${channel.name}</div>
                    <div class="channel-info">
                        <strong>Category:</strong> ${channel.category || 'General'}<br>
                        ${isFavorite ? '<span style="color: #ffd700;">‚≠ê Favorite</span>' : ''}
                    </div>
                    <button class="play-btn" onclick="event.stopPropagation(); playChannel(${JSON.stringify(channel).replace(/"/g, '&quot;')})">
                        ‚ñ∂Ô∏è Play Channel
                    </button>
                `;
                channelGrid.appendChild(card);
            });
        }

        function playChannel(channel) {
            currentChannel = channel;
            playerContainer.style.display = 'block';
            
            if (Hls.isSupported()) {
                if (currentHls) {
                    currentHls.destroy();
                }
                currentHls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });
                
                currentHls.loadSource(channel.url);
                currentHls.attachMedia(video);
                currentHls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = channel.url;
                video.play();
            }
            
            document.title = `${channel.name} - SA TV Streams`;
            updateFavoriteButton();
        }

        function hidePlayer() {
            playerContainer.style.display = 'none';
            if (currentHls) {
                currentHls.destroy();
                currentHls = null;
            }
            video.pause();
            video.src = '';
            document.title = 'SA TV Streams';
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                playerContainer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function addToFavorites() {
            if (!currentChannel) return;
            
            const exists = favorites.some(fav => fav.url === currentChannel.url);
            if (exists) {
                favorites = favorites.filter(fav => fav.url !== currentChannel.url);
                showStatus('‚ùå Removed from favorites');
            } else {
                favorites.push(currentChannel);
                showStatus('‚≠ê Added to favorites');
            }
            
            localStorage.setItem('saTvFavorites', JSON.stringify(favorites));
            updateFavoriteButton();
            renderFavorites();
            renderChannels(); // Refresh favorite badges
        }

        function updateFavoriteButton() {
            const btn = document.getElementById('favoriteBtn');
            const isFavorite = favorites.some(fav => fav.url === currentChannel?.url);
            btn.textContent = isFavorite ? 'üíõ Remove Favorite' : '‚≠ê Add to Favorites';
        }

        function renderFavorites() {
            const section = document.getElementById('favoritesSection');
            const list = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            list.innerHTML = favorites.map(ch => 
                `<div style="padding: 10px; cursor: pointer; border-radius: 10px; background: rgba(255,215,0,0.1); margin: 5px 0;" 
                     onclick="playChannel(${JSON.stringify(ch).replace(/"/g, '&quot;')})">
                    ${ch.logo || 'üì∫'} ${ch.name}
                </div>`
            ).join('');
            
            section.style.display = 'block';
        }

        function filterCategories() {
            const categories = [...new Set(channels.map(ch => ch.category).filter(Boolean))];
            categoryFilter.innerHTML = '<option value="">All Categories</option>' + 
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        categoryFilter.addEventListener('change', (e) => {
            const filtered = e.target.value 
                ? channels.filter(ch => ch.category === e.target.value)
                : channels;
            renderChannels(filtered);
        });

        function showStatus(message, duration = 3000) {
            status.textContent = message;
            status.style.display = 'block';
            status.style.background = message.includes('‚úÖ') ? '#4CAF50' : 
                                     message.includes('‚ùå') ? '#f44336' : '#2196F3';
            setTimeout(() => {
                status.style.display = 'none';
            }, duration);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hidePlayer();
            if (e.key === 'f' || e.key === 'F') toggleFullscreen();
        });

        // Initialize
        renderFavorites();
    </script>
</body>
</html>
